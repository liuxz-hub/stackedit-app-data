# 一、Linux 下 UART 驱动框架
## 1、uart_driver 注册与注销
每个串口驱动都需要定义一个 `uart_driver`，加载驱动的时候通过 `uart_register_driver` 函数向系统注册这个 `uart_driver`，此函数原型如下：  
```cpp
int uart_register_driver(struct uart_driver *drv)
```

注销驱动的时候也需要注销掉前面注册的 `uart_driver`，需要用到 `uart_unregister_driver` 函数，  
函数原型如下：  
```cpp
void uart_unregister_driver(struct uart_driver *drv)  
```

## 2、uart_port 的添加与移除
每个 UART 都有一个 `uart_port`，`uart_port` 中最主要的就是 `ops` 成员变量， `ops` 包含了串口的具体驱动函数。

那么 `uart_port` 是怎么和 `uart_driver `结合起来的呢？这里要用到 `uart_add_one_port` 函数，函数原型如下：  
```cpp
int uart_add_one_port(struct uart_driver *drv,  struct uart_port *uport)
```
函数参数和返回值含义如下：  
drv：此 port 对应的` uart_driver`
uport： 要添加到 `uart_driver` 中的` port`
返回值： 0，成功；负值，失败。

卸载 UART 驱动的时候也需要将 `uart_port` 从相应的 `uart_driver` 中移除，需要用到`uart_remove_one_port `函数，函数原型如下：  
```cpp
int uart_remove_one_port(struct uart_driver *drv, struct uart_port *uport)  
```
函数参数和返回值含义如下：  
drv：要卸载的 `port` 所对应的` uart_driver`
uport： 要卸载的 `uart_port`
返回值： 0，成功；负值，失败。

# 二、RS232 驱动编写
I.MX6U 的 UART 驱动 NXP 已经编写好了，所以不需要我们编写。我们要做的就是在设备树中添加 UART3 对应的设备节点即可。

## 1、UART3 IO 节点创建
UART3 用到了`UART3_TXD` 和`UART3_RXD` 这两个IO，因此要先在 iomuxc 中创建UART3对应的 `pinctrl` 子节点，在 iomuxc 中添加如下内容：
```c
pinctrl_uart3: uart3grp {
	fsl,pins = <
		MX6UL_PAD_UART3_TX_DATA__UART3_DCE_TX   0x1b0b1
		MX6UL_PAD_UART3_RX_DATA__UART3_DCE_RX   0x1b0b1
	>;
};
```
## 2、添加 uart3 节点
```c
&uart3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart3>;
	status = "okay";
};
```

# 三、移植 minicom
## 1、


## 2、

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTgyOTIzNjMzMSwtMTI4OTkyMTkwNiwtMT
E5OTQxOTE5Myw5OTU4NDYyNF19
-->
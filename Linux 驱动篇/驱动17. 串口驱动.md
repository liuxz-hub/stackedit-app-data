# 一、Linux 下 UART 驱动框架
## 1、uart_driver 注册与注销
每个串口驱动都需要定义一个 `uart_driver`，加载驱动的时候通过 `uart_register_driver` 函数向系统注册这个 `uart_driver`，此函数原型如下：  
```cpp
int uart_register_driver(struct uart_driver *drv)
```

注销驱动的时候也需要注销掉前面注册的 `uart_driver`，需要用到 `uart_unregister_driver` 函数，  
函数原型如下：  
```cpp
void uart_unregister_driver(struct uart_driver *drv)  
```

## 2、uart_port 的添加与移除
每个 UART 都有一个 `uart_port`，`uart_port` 中最主要的就是 `ops` 成员变量， `ops` 包含了串口的具体驱动函数。

那么 `uart_port` 是怎么和 `uart_driver `结合起来的呢？这里要用到 `uart_add_one_port` 函数，函数原型如下：  
```cpp
int uart_add_one_port(struct uart_driver *drv,  struct uart_port *uport)
```
函数参数和返回值含义如下：  
drv：此 port 对应的` uart_driver`
uport： 要添加到 `uart_driver` 中的` port`
返回值： 0，成功；负值，失败。

卸载 UART 驱动的时候也需要将 `uart_port` 从相应的 `uart_driver` 中移除，需要用到`uart_remove_one_port `函数，函数原型如下：  
```cpp
int uart_remove_one_port(struct uart_driver *drv, struct uart_port *uport)  
```
函数参数和返回值含义如下：  
drv：要卸载的 `port` 所对应的` uart_driver`
uport： 要卸载的 `uart_port`
返回值： 0，成功；负值，失败。

# 二、RS232 驱动编写
I.MX6U 的 UART 驱动 NXP 已经编写好了，所以不需要我们编写。我们要做的就是在设备树中添加 UART3 对应的设备节点即可。

## 1、UART3 IO 节点创建

·
<!--stackedit_data:
eyJoaXN0b3J5IjpbNDcyNDkyOTA0LC0xMTk5NDE5MTkzLDk5NT
g0NjI0XX0=
-->
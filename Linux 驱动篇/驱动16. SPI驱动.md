# 一、SPI驱动编写

SPI 主机驱动的核心就是申请 `spi_master`，然后初始化 `spi_master`，最后向 Linux 内核注册 `spi_master`。  
1、 spi_master 申请与释放  
`spi_alloc_master`函数用于申请 `spi_master`，函数原型如下：  
```
struct spi_master *spi_alloc_master(struct device *dev, unsigned size)
```
函数参数和返回值含义如下：
dev：设备，一般是 `platform_device` 中的 dev 成员变量。  
size： 私有数据大小，可以通过 `spi_master_get_devdata` 函数获取到这些私有数据。  
返回值： 申请到的 `spi_master`。  

`spi_master` 的释放通过 `spi_master_put` 函数来完成，当我们删除一个 SPI 主机驱动的时候就  
需要释放掉前面申请的 `spi_master`， `spi_master_put`函数原型如下：  
```
void spi_master_put(struct spi_master *master)  
```
函数参数和返回值含义如下：  master：要释放的 spi_master。  









## 1、修改设备树
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTc1NjUwMTgwMl19
-->